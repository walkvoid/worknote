# java常见的关键字
## volatile关键字
依照java的内存模型，在方法执行过程中访问位于主内存的变量时，会先拷贝一份到当前线程的私有内存，当更新完这个变量后，并不会立刻将此次
变更刷新到主内存，这会造成其他线程从主内存取到的变量是旧值，如果这个变量被volatile修饰，则可以强制变量更新后马上刷新到主内存，保证
其他线程对此次变更可见，这就是volatile保证可见性的原理。

编译器可以在不改变单线程程序语义的情况下，处于性能提升的考量对代码语句顺序进行调整。但是针对有数据依赖的代码，编译器无法识别多线程环境下的
数据依赖性，进而"错误"的进行重排序，这就会导致多线程运行此段代码时产生错误的结果。volatile关键字就可以禁用这种重排序，它是借助系统底层的
内存屏障来实现的。

volatile仅仅是保证当前线程读取到的变量是最新的，但是其他线程也可以读取并更新此变量，当前线程是无法感知的，除非当前线程重新读取。所以在CAS的
无锁实现中都是循环的读取最新的值符合预期做一些后置操作。这就引申出了volatile的应用场景，所有涉及到CAS操作的变量都应该加volatile关键字。
例如我们Atomicxxx类的value字段，AQS队列同步器的state字段等等。

参考：
- [并发理论基础：指令重排序问题](https://zhuanlan.zhihu.com/p/298448987)
- [volatile底层原理：从CPU架构到内存屏障之旅](https://juejin.cn/post/7070091066044579876)